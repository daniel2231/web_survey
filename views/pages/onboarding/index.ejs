<html lang="en" class="h-100">
  <head>
    <%- include('../../partials/head'); %>
  </head>
  <body class="d-flex flex-column h-100">
    <%- include('../../partials/navbar', {title: "Terms and agreement"}) %>

    <div class="p-3">
      <h5>연구 안내</h5>
      <div class="mt-3 border p-3">
        본 실험에서는 교육용 에이전트와의 단어암기 테스트를 수행함에 따라
        사용자의 반응에 어떠한 영향을 미치는지 알아보고, 이를 통해 인터페이스의
        개선점을 연구하고자 합니다
      </div>
      <div class="d-flex justify-content-end mt-4">
        <input
          type="checkbox"
          class="btn-check"
          id="btn-check1"
          autocomplete="off"
        />
        <label class="btn btn-primary" id="btn-label1" for="btn-check1"
          >동의합니다</label
        >
      </div>
    </div>
    <div class="p-3">
      <h5>개인정보에 대한 비밀보장</h5>
      <div class="mt-3 border p-3">
        피험자는 실험 후 3,000원의 참여비를 지급받는다. 실험참여와 설문응답이
        모두 끝나면 참여비 지급을 위한 개인 정보 (이름, 연락처, 주민번호, 계좌
        정보, 소속) 에 대한 내용을 기입하며, 이는, 본교 관할 세무서에 통보하는
        목적과 실험 참여 비 지급 이외에
      </div>
      <div class="d-flex justify-content-end mt-4">
        <input
          type="checkbox"
          class="btn-check"
          id="btn-check2"
          autocomplete="off"
        />
        <label class="btn btn-primary" id="btn-label2" for="btn-check2"
          >동의합니다</label
        >
      </div>
    </div>
    <div class="p-3">
      <h5>추가 동의</h5>
      <div class="mt-3 border p-3">
        본 실험을 통해 얻어진 귀하의 자료는 향후의 다른 연구에서도 사용되어 더
        가치 있는 연구의 결과로 사용 될 수 있습니다. 귀하의 자료를 미래의 다른
        연구에 사용하는 것에 대해 다음 항목에 동의하시겠습니까?
      </div>
      <div class="d-flex justify-content-end mt-4">
        <input
          type="checkbox"
          class="btn-check"
          id="btn-check3"
          autocomplete="off"
        />
        <label class="btn btn-primary" id="btn-label3" for="btn-check3"
          >동의합니다</label
        >
      </div>
    </div>

    <form>
      <div class="info-input mt-3 p-3">
        <div class="mb-3">
          <label for="info-name" class="form-label">세션 코드</label>
          <input
            type="text"
            class="form-control"
            id="codeInput"
            placeholder="세션 코드"
          />
        </div>
        <div class="mb-3">
          <label for="info-name" class="form-label">참여자 성명</label>
          <input
            type="text"
            class="form-control"
            id="nameInput"
            placeholder="참여자 성명"
          />
        </div>
        <div class="mb-3">
          <label for="info-input" class="form-label"
            >참여자 휴대폰번호(예: 01011112222)</label
          >
          <input
            type="number"
            class="form-control"
            id="phoneInput"
            placeholder="01011112222"
          />
        </div>
        <div class="d-grid">
          <button disabled class="btn btn-primary" id="submitBtn">
            Submit
          </button>
        </div>
      </div>
    </form>

    <script>
      const checkBtn1 = document.querySelector("#btn-check1");
      const checkBtnLabel1 = document.querySelector("#btn-label1");
      const checkBtn2 = document.querySelector("#btn-check2");
      const checkBtnLabel2 = document.querySelector("#btn-label2");
      const checkBtn3 = document.querySelector("#btn-check3");
      const checkBtnLabel3 = document.querySelector("#btn-label3");
      // if check array is all true, submit button is enabled
      const submitBtn = document.querySelector("#submitBtn");

      let check = [false, false, false];

      checkBtn1.addEventListener("click", () => {
        checkBtn1.setAttribute("disabled", "");
        checkBtnLabel1.textContent = "동의 되었습니다";
        check[0] = true;

        if (check[0] && check[1] && check[2]) {
          submitBtn.removeAttribute("disabled");
        }
      });

      checkBtn2.addEventListener("click", () => {
        checkBtn2.setAttribute("disabled", "");
        checkBtnLabel2.textContent = "동의 되었습니다";
        check[1] = true;

        if (check[0] && check[1] && check[2]) {
          submitBtn.removeAttribute("disabled");
        }
      });

      checkBtn3.addEventListener("click", () => {
        checkBtn3.setAttribute("disabled", "");
        checkBtnLabel3.textContent = "동의 되었습니다";
        check[2] = true;

        if (check[0] && check[1] && check[2]) {
          submitBtn.removeAttribute("disabled");
        }
      });

      submitBtn.addEventListener("click", function (event) {
        event.preventDefault();

        const code = document.getElementById("codeInput").value;
        const name = document.getElementById("nameInput").value;
        const phone = document.getElementById("phoneInput").value;

        if (code.length && name.length && phone.length) {
          let data = {
            session_code: code,
            name: name,
            phone: phone,
            bank_balance: 100000,
          };
          window.localStorage.setItem("balance", 100000);
          window.localStorage.setItem("phone", phone);
          window.localStorage.setItem("session_code", code);
          fetch("/onboarding/new-user", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          }).then((res) => {
            if (res.status == 404) {
              alert("코드를 다시 확인하세요");
            } else {
              console.log("Request complete! response:", res);
              window.location.href = "/onboarding/info";
            }
          });
        } else {
          alert("코드 번호, 이름과 휴대폰 번호를 확인해주세요.");
        }
      });
    </script>
  </body>
</html>
